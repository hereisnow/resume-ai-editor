<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Resume Editor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
<script>
/* ====== CONFIG ====== */
const API_BASE = "https://resume-ai-editor-backend.onrender.com";

/* ====== MODE SWITCHING ====== */
const modeCards = document.querySelectorAll(".mode-card");
const analyzePanel = document.getElementById("analyze-panel");
const generatePanel = document.getElementById("generate-panel");

modeCards.forEach(card => {
  card.addEventListener("click", () => {
    const mode = card.dataset.mode;

    modeCards.forEach(c => {
      c.classList.remove("border-violet-400", "bg-violet-50", "border-sky-400", "bg-sky-50");
      c.querySelector(".mode-arrow-right").classList.remove("hidden");
      c.querySelector(".mode-arrow-down").classList.add("hidden");
    });

    if (mode === "analyze") {
      analyzePanel.classList.remove("hidden");
      generatePanel.classList.add("hidden");
      card.classList.add("border-violet-400", "bg-violet-50");
    }

    if (mode === "generate") {
      generatePanel.classList.remove("hidden");
      analyzePanel.classList.add("hidden");
      card.classList.add("border-sky-400", "bg-sky-50");
    }

    card.querySelector(".mode-arrow-right").classList.add("hidden");
    card.querySelector(".mode-arrow-down").classList.remove("hidden");
  });
});

/* ====== ANALYZE ====== */
const aForm = document.getElementById("aForm");
const aFile = document.getElementById("aFile");
const aText = document.getElementById("aText");
const aRole = document.getElementById("aRole");
const aResult = document.getElementById("aResult");

aForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  let text = aText.value.trim();

  try {
    // пробуем прочитать файл, если он есть
    if (aFile.files.length > 0) {
      const file = aFile.files[0];
      // пока просто читаем как текст; для PDF это будет "шум", но не пусто
      text = await file.text();
    }

    if (!text) {
      aResult.innerHTML = "<p class='text-xs text-slate-500'>Please upload a file or paste resume text.</p>";
      return;
    }

    aResult.innerHTML = "<p class='text-xs text-slate-500'>Analyzing...</p>";

    const resp = await fetch(`${API_BASE}/api/analyze`, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({
        resumeText: text,
        targetRole: aRole.value.trim()
      })
    });

    if (!resp.ok) {
      const errText = await resp.text();
      console.error("Analyze HTTP error:", resp.status, errText);
      aResult.innerHTML =
        "<p class='text-xs text-red-500'>Server error while analyzing resume. Check backend logs.</p>";
      return;
    }

    let json;
    try {
      json = await resp.json();
    } catch (err) {
      console.error("Analyze JSON parse error:", err);
      aResult.innerHTML =
        "<p class='text-xs text-red-500'>Invalid JSON from backend. Check backend implementation.</p>";
      return;
    }

    if (!json.ok) {
      console.error("Analyze returned not ok:", json);
      aResult.innerHTML =
        `<p class='text-xs text-red-500'>AI error: ${json.error || "unknown error"}</p>`;
      return;
    }

    const r = json.review;

    aResult.innerHTML = `
      <div class="mb-2 text-xs">
        Score: <span class="font-semibold">${r.overall_score}/100</span>
      </div>
      <p class="text-xs mb-2">${r.summary}</p>

      <h4 class="font-semibold text-[11px] uppercase mt-3">Strengths</h4>
      <ul class="list-disc pl-4 text-xs">
        ${r.strengths.map(s => `<li>${s}</li>`).join("")}
      </ul>

      <h4 class="font-semibold text-[11px] uppercase mt-3">Issues</h4>
      <ul class="list-disc pl-4 text-xs">
        ${r.issues.map(s => `<li>${s}</li>`).join("")}
      </ul>

      <h4 class="font-semibold text-[11px] uppercase mt-3">Next Steps</h4>
      <ul class="list-disc pl-4 text-xs">
        ${r.next_steps.map(s => `<li>${s}</li>`).join("")}
      </ul>
    `;
  } catch (err) {
    console.error("Analyze JS error:", err);
    aResult.innerHTML =
      "<p class='text-xs text-red-500'>Unexpected error on front-end. See console for details.</p>";
  }
});

/* ====== GENERATE ====== */
const gForm = document.getElementById("gForm");
const gResult = document.getElementById("gResult");

gForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  const data = {
    name: gForm.querySelector("#gName").value.trim(),
    contact: gForm.querySelector("#gContact").value.trim(),
    role: gForm.querySelector("#gRole").value.trim(),
    level: gForm.querySelector("#gLevel").value,
    summaryNotes: gForm.querySelector("#gSummary").value.trim(),
    skills: gForm.querySelector("#gSkills").value.split(",").map(s => s.trim()).filter(Boolean),
    experienceNotes: gForm.querySelector("#gExp").value.trim(),
    education: gForm.querySelector("#gEdu").value.trim()
  };

  try {
    gResult.innerHTML = "<p class='text-xs text-slate-500'>Generating...</p>";

    const resp = await fetch(`${API_BASE}/api/generate`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    if (!resp.ok) {
      const errText = await resp.text();
      console.error("Generate HTTP error:", resp.status, errText);
      gResult.innerHTML =
        "<p class='text-xs text-red-500'>Server error while generating resume. Check backend logs.</p>";
      return;
    }

    let json;
    try {
      json = await resp.json();
    } catch (err) {
      console.error("Generate JSON parse error:", err);
      gResult.innerHTML =
        "<p class='text-xs text-red-500'>Invalid JSON from backend. Check backend implementation.</p>";
      return;
    }

    if (!json.ok) {
      console.error("Generate returned not ok:", json);
      gResult.innerHTML =
        `<p class='text-xs text-red-500'>AI error: ${json.error || "unknown error"}</p>`;
      return;
    }

    const r = json.resume;

    let html = `
      <h1 class="font-semibold text-sm">${data.name || "Your Name"}</h1>
      <p class="text-xs text-slate-500 mb-2">${data.contact}</p>

      <h2 class="text-[11px] uppercase font-semibold mt-3">Summary</h2>
      <p class="text-xs">${r.summary}</p>

      <h2 class="text-[11px] uppercase font-semibold mt-3">Skills</h2>
      <ul class="list-disc pl-4 text-xs">
        ${r.skills.map(s => `<li>${s}</li>`).join("")}
      </ul>

      <h2 class="text-[11px] uppercase font-semibold mt-3">Experience</h2>
    `;

    r.experience.forEach(x => {
      html += `
        <p class="mt-2 font-semibold text-xs">${x.title} — ${x.company}</p>
        <p class="text-[11px] text-slate-500">
          ${x.location || ""} ${x.dates ? " · " + x.dates : ""}
        </p>
        <ul class="list-disc pl-4 text-xs">
          ${x.bullets.map(b => `<li>${b}</li>`).join("")}
        </ul>
      `;
    });

    html += `
      <h2 class="text-[11px] uppercase font-semibold mt-3">Education</h2>
    `;

    r.education.forEach(ed => {
      html += `
        <p class="mt-2 font-semibold text-xs">${ed.degree} — ${ed.school}</p>
        <p class="text-[11px] text-slate-500">${ed.dates}</p>
        <p class="text-xs">${ed.details}</p>
      `;
    });

    gResult.innerHTML = html;
  } catch (err) {
    console.error("Generate JS error:", err);
    gResult.innerHTML =
      "<p class='text-xs text-red-500'>Unexpected error on front-end. See console for details.</p>";
  }
});
</script>



<script>
/* ====== CONFIG ====== */
const API_BASE = "https://resume-ai-editor-backend.onrender.com";

/* ====== MODE SWITCHING ====== */
const modeCards = document.querySelectorAll(".mode-card");
const analyzePanel = document.getElementById("analyze-panel");
const generatePanel = document.getElementById("generate-panel");

modeCards.forEach(card => {
  card.addEventListener("click", () => {
    const mode = card.dataset.mode;

    modeCards.forEach(c => {
      c.classList.remove("border-violet-400", "bg-violet-50", "border-sky-400", "bg-sky-50");
      c.querySelector(".mode-arrow-right").classList.remove("hidden");
      c.querySelector(".mode-arrow-down").classList.add("hidden");
    });

    if (mode === "analyze") {
      analyzePanel.classList.remove("hidden");
      generatePanel.classList.add("hidden");
      card.classList.add("border-violet-400", "bg-violet-50");
    }

    if (mode === "generate") {
      generatePanel.classList.remove("hidden");
      analyzePanel.classList.add("hidden");
      card.classList.add("border-sky-400", "bg-sky-50");
    }

    card.querySelector(".mode-arrow-right").classList.add("hidden");
    card.querySelector(".mode-arrow-down").classList.remove("hidden");
  });
});

/* ====== ANALYZE ====== */
const aForm = document.getElementById("aForm");
const aFile = document.getElementById("aFile");
const aText = document.getElementById("aText");
const aRole = document.getElementById("aRole");
const aResult = document.getElementById("aResult");

aForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  let text = aText.value.trim();

  if (aFile.files.length > 0) {
    const file = aFile.files[0];
    text = await file.text();
  }

  if (!text) {
    aResult.innerHTML = "<p class='text-xs text-slate-500'>Please upload or paste resume text.</p>";
    return;
  }

  aResult.innerHTML = "<p class='text-xs text-slate-500'>Analyzing...</p>";

  const resp = await fetch(`${API_BASE}/api/analyze`, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      resumeText: text,
      targetRole: aRole.value.trim()
    })
  });

  const json = await resp.json();
  if (!json.ok) {
    aResult.innerHTML = "<p class='text-xs text-red-500'>AI error.</p>";
    return;
  }

  const r = json.review;

  aResult.innerHTML = `
    <div class="mb-2 text-xs">Score: <span class="font-semibold">${r.overall_score}/100</span></div>
    <p class="text-xs mb-2">${r.summary}</p>

    <h4 class="font-semibold text-[11px] uppercase mt-3">Strengths</h4>
    <ul class="list-disc pl-4 text-xs">${r.strengths.map(s => `<li>${s}</li>`).join("")}</ul>

    <h4 class="font-semibold text-[11px] uppercase mt-3">Issues</h4>
    <ul class="list-disc pl-4 text-xs">${r.issues.map(s => `<li>${s}</li>`).join("")}</ul>

    <h4 class="font-semibold text-[11px] uppercase mt-3">Next Steps</h4>
    <ul class="list-disc pl-4 text-xs">${r.next_steps.map(s => `<li>${s}</li>`).join("")}</ul>
  `;
});

/* ====== GENERATE ====== */
const gForm = document.getElementById("gForm");
const gResult = document.getElementById("gResult");

gForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  const data = {
    name: gForm.querySelector("#gName").value.trim(),
    contact: gForm.querySelector("#gContact").value.trim(),
    role: gForm.querySelector("#gRole").value.trim(),
    level: gForm.querySelector("#gLevel").value,
    summaryNotes: gForm.querySelector("#gSummary").value.trim(),
    skills: gForm.querySelector("#gSkills").value.split(",").map(s => s.trim()).filter(Boolean),
    experienceNotes: gForm.querySelector("#gExp").value.trim(),
    education: gForm.querySelector("#gEdu").value.trim()
  };

  gResult.innerHTML = "<p class='text-xs text-slate-500'>Generating...</p>";

  const resp = await fetch(`${API_BASE}/api/generate`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });

  const json = await resp.json();
  if (!json.ok) {
    gResult.innerHTML = "<p class='text-xs text-red-500'>AI error.</p>";
    return;
  }

  const r = json.resume;

  let html = `
    <h1 class="font-semibold text-sm">${data.name || "Your Name"}</h1>
    <p class="text-xs text-slate-500 mb-2">${data.contact}</p>

    <h2 class="text-[11px] uppercase font-semibold mt-3">Summary</h2>
    <p class="text-xs">${r.summary}</p>

    <h2 class="text-[11px] uppercase font-semibold mt-3">Skills</h2>
    <ul class="list-disc pl-4 text-xs">${r.skills.map(s => `<li>${s}</li>`).join("")}</ul>

    <h2 class="text-[11px] uppercase font-semibold mt-3">Experience</h2>
  `;

  r.experience.forEach(x => {
    html += `
      <p class="mt-2 font-semibold text-xs">${x.title} — ${x.company}</p>
      <p class="text-[11px] text-slate-500">${x.location || ""} ${x.dates ? " · "+x.dates : ""}</p>
      <ul class="list-disc pl-4 text-xs">${x.bullets.map(b => `<li>${b}</li>`).join("")}</ul>
    `;
  });

  html += `
    <h2 class="text-[11px] uppercase font-semibold mt-3">Education</h2>
  `;

  r.education.forEach(ed => {
    html += `
      <p class="mt-2 font-semibold text-xs">${ed.degree} — ${ed.school}</p>
      <p class="text-[11px] text-slate-500">${ed.dates}</p>
      <p class="text-xs">${ed.details}</p>
    `;
  });

  gResult.innerHTML = html;
});
</script>

</body>
</html>
