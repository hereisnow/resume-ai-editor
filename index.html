<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Resume Editor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É, –ø–æ–∫–∞ –≤—Å—ë –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ "—É–∑–∫–æ–≥–æ" —Å–æ—Å—Ç–æ—è–Ω–∏—è -->
  <style>
    html.app-loading {
      visibility: hidden;
    }
  </style>
  <script>
    document.documentElement.classList.add('app-loading');
    window.addEventListener('load', function () {
      document.documentElement.classList.remove('app-loading');
    });
  </script>

  <style>
    :root {
      --bg: #f3f4f6;
      --panel: #ffffff;
      --panel-soft: #f9fafb;
      --border: #e5e7eb;
      --border-strong: #d1d5db;
      --text-main: #0f172a;
      --text-sub: #6b7280;
      --accent-blue: #2563eb;
      --accent-purple: #4f46e5;
      --radius-xl: 18px;
      --radius-lg: 14px;
      --radius-md: 10px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.12);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .app-shell {
      max-width: 1360px;   /* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–æ–∫–∞—è –æ–±–ª–∞—Å—Ç—å, –≤—Å–µ–≥–¥–∞ –æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ */
      margin: 0 auto;
      padding: 32px 20px 48px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .title {
      font-size: 24px;
      font-weight: 800;
      letter-spacing: -0.02em;
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 13px;
      color: var(--text-sub);
    }

    .main-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr); /* –¥–≤–µ —Ä–∞–≤–Ω—ã–µ —à–∏—Ä–æ–∫–∏–µ –∫–æ–ª–æ–Ω–∫–∏ */
      gap: 24px;
      margin-top: 24px;
    }

    @media (max-width: 960px) {
      .main-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--panel);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border);
      padding: 20px 20px 18px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 13px;
      color: var(--text-sub);
      padding-bottom: 6px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .card-tag-link {
      font-size: 11px;
      color: var(--accent-blue);
      cursor: pointer;
    }

    .card-body {
      background: #f5f7fb;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .dropzone {
      border-radius: var(--radius-lg);
      border: 2px dashed var(--border);
      background: var(--panel);
      padding: 30px 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      cursor: pointer;
      transition: 0.15s ease;
      gap: 6px;
    }

    .dropzone.dragover {
      border-color: var(--accent-blue);
      background: #eff6ff;
    }

    .dropzone-title {
      font-size: 14px;
      font-weight: 600;
    }

    .dropzone-sub {
      font-size: 11px;
      color: var(--text-sub);
    }

    .textarea {
      width: 100%;
      height: 260px;          /* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±–æ–ª—å—à–∞—è –≤—ã—Å–æ—Ç–∞ —Å—Ä–∞–∑—É */
      resize: vertical;
      padding: 10px 12px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      font-size: 13px;
      background: var(--panel);
      outline: none;
      line-height: 1.45;
    }

    .textarea:focus {
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 2px rgba(37,99,235,0.22);
      background: #ffffff;
    }

    .hint {
      font-size: 11px;
      color: var(--text-sub);
    }

    .prompt-input-row {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .prompt-input {
      width: 100%;
      padding: 10px 14px;
      border-radius: 9999px;
      border: 1px solid var(--border);
      font-size: 13px;
      background: var(--panel);
      outline: none;
    }

    .prompt-input:focus {
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 2px rgba(37,99,235,0.22);
      background: #ffffff;
    }

    .chips-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .chip {
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 9999px;
      background: #e5e7eb;
      color: #374151;
      border: none;
      cursor: pointer;
      white-space: nowrap;
    }

    .chip:hover {
      background: #d1d5db;
    }

    .advanced {
      margin-top: 4px;
      border-radius: var(--radius-md);
      border: 1px dashed var(--border);
      padding: 8px 10px;
      background: #f9fafb;
    }

    .advanced-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 11px;
      color: var(--text-sub);
      cursor: pointer;
    }

    .advanced-title { font-weight: 600; }

    .advanced-body {
      margin-top: 8px;
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 8px;
    }

    @media (max-width: 640px) {
      .advanced-body { grid-template-columns: minmax(0, 1fr); }
    }

    .advanced-body.hidden { display: none; }

    .advanced-label {
      font-size: 11px;
      color: var(--text-sub);
      margin-bottom: 4px;
    }

    .advanced-control {
      width: 100%;
      padding: 6px 10px;
      border-radius: 9999px;
      border: 1px solid var(--border);
      font-size: 12px;
      background: #ffffff;
      outline: none;
    }

    .advanced-control:focus {
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 2px rgba(37,99,235,0.20);
    }

    .actions-row {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 10px;
    }

    .btn {
      border-radius: 9999px;
      border: none;
      padding: 10px 22px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      color: #ffffff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-analyze { background: var(--accent-purple); }
    .btn-generate { background: var(--accent-blue); }

    .btn:disabled {
      opacity: 0.7;
      cursor: default;
    }

    .result-inner {
      background: var(--panel-soft);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      min-height: 260px;         /* —Ç–æ–∂–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±–æ–ª—å—à–∞—è –≤—ã—Å–æ—Ç–∞ */
      padding: 16px 14px;
      font-size: 13px;
      color: var(--text-sub);
      white-space: pre-wrap;
      overflow-y: auto;
    }

    .right-header-extra {
      display: flex;
      gap: 8px;
      align-items: center;
      font-size: 14px;
    }

    .icon-btn {
      width: 26px;
      height: 26px;
      border-radius: 9999px;
      border: 1px solid var(--border);
      background: #f9fafb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="topbar">
      <div>
        <div class="title">AI Resume Editor</div>
        <div class="subtitle">
          Based on real needs of Reddit users ¬∑ Drag &amp; drop your existing resume and improve it with AI.
        </div>
      </div>
    </header>

    <main class="main-grid">
      <!-- LEFT: SOURCE RESUME -->
      <section class="card">
        <div class="card-header">
          <span class="card-title">Source Resume</span>
          <span class="card-tag-link">ATS Scan View</span>
        </div>
        <div class="card-body">
          <div id="dropzone" class="dropzone">
            <div class="dropzone-title">Drag &amp; Drop PDF, DOCX, TXT</div>
            <div class="dropzone-sub">Max: PDF 5MB, DOCX 3MB ¬∑ or click to browse</div>
          </div>
          <input id="fileInput" type="file" accept=".pdf,.doc,.docx,.txt" style="display:none" />

          <textarea id="sourceText" class="textarea" placeholder="Extracted resume text will appear here... You can also paste text directly."></textarea>
          <div class="hint">Make sure the text looks clean before sending it to AI.</div>

          <div class="prompt-input-row">
            <input id="prompt" class="prompt-input" type="text" placeholder="E.g., Rewrite for a Senior Developer role, focusing on leadership..." />
            <div class="chips-row">
              <button type="button" class="chip" id="chipGrammar">Fix Grammar</button>
              <button type="button" class="chip" id="chipTone">Professional Tone</button>
              <button type="button" class="chip" id="chipMetrics">Add Metrics</button>
            </div>
          </div>

          <div class="advanced" id="advancedBox">
            <div class="advanced-header" id="advancedToggle">
              <span class="advanced-title">Advanced settings</span>
              <span id="advancedToggleLabel">Show</span>
            </div>
            <div class="advanced-body hidden" id="advancedBody">
              <div>
                <div class="advanced-label">Target language</div>
                <select id="advLanguage" class="advanced-control">
                  <option value="en" selected>English</option>
                  <option value="ru">Russian</option>
                </select>
              </div>
              <div>
                <div class="advanced-label">Career level</div>
                <select id="advLevel" class="advanced-control">
                  <option value="student">Student / Entry</option>
                  <option value="mid">Mid-level</option>
                  <option value="senior">Senior</option>
                </select>
              </div>
              <div>
                <div class="advanced-label">Target role (optional)</div>
                <input id="advRole" class="advanced-control" type="text" placeholder="e.g. Frontend Developer" />
              </div>
              <div>
                <div class="advanced-label">Tone</div>
                <select id="advTone" class="advanced-control">
                  <option value="neutral">Neutral professional</option>
                  <option value="formal">Formal</option>
                  <option value="concise">Extra concise</option>
                </select>
              </div>
            </div>
          </div>

          <div class="actions-row">
            <button id="analyzeBtn" class="btn btn-analyze" type="button">üîç Analyze</button>
            <button id="generateBtn" class="btn btn-generate" type="button">‚ú® Generate</button>
          </div>
        </div>
      </section>

      <!-- RIGHT: AI RESULT -->
      <section class="card">
        <div class="card-header">
          <span class="card-title">AI Result</span>
          <div class="right-header-extra">
            <button type="button" class="icon-btn" id="btnCopy" title="Copy to clipboard">üìã</button>
            <button type="button" class="icon-btn" id="btnDownload" title="Download TXT">üìÑ</button>
            <button type="button" class="icon-btn" id="btnEditToSource" title="Send back to source">‚úèÔ∏è</button>
          </div>
        </div>
        <div class="result-inner" id="aiOutput">AI generated content will appear here...</div>
      </section>
    </main>
  </div>

  <!-- DOCX -->
  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  <!-- PDF -->
  <script type="module">
    import * as pdfjsLib from "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.min.mjs";

    const BACKEND_URL = "https://resume-ai-editor-backend.onrender.com";

    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const sourceText = document.getElementById('sourceText');
    const promptInput = document.getElementById('prompt');
    const aiOutput = document.getElementById('aiOutput');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const generateBtn = document.getElementById('generateBtn');

    const advancedBody = document.getElementById('advancedBody');
    const advancedToggle = document.getElementById('advancedToggle');
    const advancedToggleLabel = document.getElementById('advancedToggleLabel');
    const advLanguage = document.getElementById('advLanguage');
    const advLevel = document.getElementById('advLevel');
    const advRole = document.getElementById('advRole');
    const advTone = document.getElementById('advTone');

    const chipGrammar = document.getElementById('chipGrammar');
    const chipTone = document.getElementById('chipTone');
    const chipMetrics = document.getElementById('chipMetrics');

    const btnCopy = document.getElementById('btnCopy');
    const btnDownload = document.getElementById('btnDownload');
    const btnEditToSource = document.getElementById('btnEditToSource');

    const MASTER_PROMPT = `–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–π –º–æ—ë —Ä–µ–∑—é–º–µ –ø–æ —Å–ª–µ–¥—É—é—â–µ–º—É –≤—ã—Å–æ–∫–æ–¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É –∑–∞–¥–∞–Ω–∏—é.
–†–∞–±–æ—Ç–∞–π —Å—Ç—Ä–æ–≥–æ –ø–æ –ø—É–Ω–∫—Ç–∞–º.

## 1. –û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å—Ç–∏–ª—é –∏ –∫–∞—á–µ—Å—Ç–≤—É —Ç–µ–∫—Å—Ç–∞
* –ü—Ä–∏–≤–µ–¥–∏ —Ç–µ–∫—Å—Ç –∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º—É –¥–µ–ª–æ–≤–æ–º—É —Å—Ç–∏–ª—é.
* –ü–∏—à–∏ —è—Å–Ω–æ, –ª–∞–∫–æ–Ω–∏—á–Ω–æ, –±–µ–∑ –≤–æ–¥—ã –∏ –±–µ–∑ –æ–±—â–∏—Ö —Ñ—Ä–∞–∑.
* –£–±–∏—Ä–∞–π –ø–∞—Å—Å–∏–≤–Ω—ã–π –∑–∞–ª–æ–≥, –∏—Å–ø–æ–ª—å–∑—É–π –∞–∫—Ç–∏–≤–Ω—ã–π.
* –ù–∞—á–∏–Ω–∞–π –∫–∞–∂–¥—ã–π –±—É–ª–ª–µ—Ç —Å —Å–∏–ª—å–Ω–æ–≥–æ –≥–ª–∞–≥–æ–ª–∞ –¥–µ–π—Å—Ç–≤–∏—è (Led, Delivered, Designed, Optimized –∏ –¥—Ä.).
* –ò–∑–±–µ–≥–∞–π –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–ª–æ–≤ –∏ –∫–ª–∏—à–µ.
* –î–µ–ª–∞–π —Ç–µ–∫—Å—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –ø–æ–ª—å–∑—É –¥–ª—è —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è.

## 2. –£–ª—É—á—à–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
* –î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—Ç–∞ —Ä–∞–±–æ—Ç—ã:
  - –ü—Ä–µ–æ–±—Ä–∞–∑—É–π –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.
  - –î–æ–±–∞–≤—å –º–µ—Ç—Ä–∏–∫–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–ø—Ä–µ–¥–ª–æ–∂–∏ —Ç–∏–ø–∏—á–Ω—ã–µ KPI, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã).
  - –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ç—Ä–∏ –≤–æ–ø—Ä–æ—Å–∞: –∫–∞–∫—É—é –∑–∞–¥–∞—á—É —è —Ä–µ—à–∞–ª, —á—Ç–æ —Å–¥–µ–ª–∞–ª, –∫–∞–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±–µ—Å–ø–µ—á–∏–ª.
  - –£–∫–∞–∂–∏ –º–∞—Å—à—Ç–∞–±—ã: –±—é–¥–∂–µ—Ç—ã, –∫–æ–º–∞–Ω–¥—ã, –æ–±—ä—ë–º—ã, —Å—Ä–æ–∫–∏, —Ä–æ—Å—Ç, —Å–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—å, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

## 3. ATS-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
* –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç, –±–µ–∑ —Å–ª–æ–∂–Ω–æ–π –≤—ë—Ä—Å—Ç–∫–∏.
* –ü—Ä–∏–º–µ–Ω—è–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –º–æ–µ–π —Å—Ñ–µ—Ä—ã: –Ω–∞–≤—ã–∫–∏, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –º–µ—Ç–æ–¥—ã, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, —Ä–æ–ª–∏.
* –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
  - Summary
  - Skills
  - Experience
  - Education
  - Certifications
  - Tools/Tech
  - Projects
  - Additional info
* –ò—Å–∫–ª—é—á–∏ —Ç–∞–±–ª–∏—Ü—ã, —Å—Ç–æ–ª–±—Ü—ã, –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏ —ç–º–æ–¥–∑–∏.

## 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏—Ç–æ–≥–æ–≤–æ–≥–æ —Ä–µ–∑—é–º–µ
* Professional Summary (3‚Äì4 —Å—Ç—Ä–æ–∫–∏) ‚Äî –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏, —Ü–µ–Ω–Ω–æ—Å—Ç—å.
* Core Skills / Technical Skills ‚Äî –Ω–∞–≤—ã–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.
* Experience ‚Äî –¥–æ–ª–∂–Ω–æ—Å—Ç—å, –∫–æ–º–ø–∞–Ω–∏—è, –¥–∞—Ç—ã + 4‚Äì6 –±—É–ª–ª–µ—Ç–æ–≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø–æ —Å—Ö–µ–º–µ –≥–ª–∞–≥–æ–ª ‚Üí –¥–µ–π—Å—Ç–≤–∏–µ ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí —Ü–∏—Ñ—Ä—ã.
* Education ‚Äî —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–∏–º–æ–µ.
* Projects (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî —á—Ç–æ —Å–¥–µ–ª–∞–ª –∏ –∫–∞–∫–æ–π —ç—Ñ—Ñ–µ–∫—Ç.
* Certifications / Courses / Tech Stack ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –Ω–∞–≤—ã–∫–∏.
* Additional Information ‚Äî —è–∑—ã–∫–∏, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, soft skills (–∫—Ä–∞—Ç–∫–æ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ).

## 5. –£–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏
* –†–∞–∑–±–∏–≤–∞–π –¥–ª–∏–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.
* –î–µ–ª–∞–π –ª–æ–≥–∏—á–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –Ω–∞–≤—ã–∫–æ–≤ –∏ –æ–ø—ã—Ç–∞.
* –£–±–∏—Ä–∞–π –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –∏ –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–µ –Ω—É–∂–Ω—ã–µ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—é.

## 6. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
* –ü–æ—Å–ª–µ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∑—é–º–µ:
  1. –ü–µ—Ä–µ—á–∏—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.
  2. –£–∫–∞–∂–∏, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç—ã —É–ª—É—á—à–∏–ª.
  3. –ü—Ä–µ–¥–ª–æ–∂–∏, —á—Ç–æ –µ—â—ë –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å.
  4. –î–∞–π –ø—Ä–∏–º–µ—Ä—ã –Ω–∞–≤—ã–∫–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫, —Ç–∏–ø–∏—á–Ω—ã—Ö –¥–ª—è –º–æ–µ–π –æ—Ç—Ä–∞—Å–ª–∏.

## 7. –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞
* –í—ã–≤–µ–¥–∏ –∏—Ç–æ–≥–æ–≤–æ–µ —Ä–µ–∑—é–º–µ –≤ ATS-ready —Ç–µ–∫—Å—Ç–æ–≤–æ–º –≤–∏–¥–µ.
* –ù–µ –¥–æ–±–∞–≤–ª—è–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω.
* –°–æ—Ö—Ä–∞–Ω–∏ —á—ë—Ç–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —Å–ø–∏—Å–∫–∏ –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å.`;

    // Advanced UI
    advancedToggle.addEventListener('click', () => {
      const hidden = advancedBody.classList.toggle('hidden');
      advancedToggleLabel.textContent = hidden ? 'Show' : 'Hide';
    });

    function appendPrompt(text) {
      const current = promptInput.value.trim();
      promptInput.value = current ? current + ' ¬∑ ' + text : text;
      promptInput.focus();
    }

    chipGrammar.addEventListener('click', () => appendPrompt('Fix grammar and clarity.'));
    chipTone.addEventListener('click', () => appendPrompt('Use a confident, professional tone.'));
    chipMetrics.addEventListener('click', () => appendPrompt('Add concrete metrics and impact (%, $, time saved).'));

    // Drag & drop
    ['dragenter','dragover'].forEach(evt => {
      dropzone.addEventListener(evt, e => {
        e.preventDefault();
        e.stopPropagation();
        dropzone.classList.add('dragover');
      });
    });
    ['dragleave','drop'].forEach(evt => {
      dropzone.addEventListener(evt, e => {
        e.preventDefault();
        e.stopPropagation();
        dropzone.classList.remove('dragover');
      });
    });

    dropzone.addEventListener('click', () => fileInput.click());

    dropzone.addEventListener('drop', e => {
      const file = e.dataTransfer.files?.[0];
      if (file) handleFile(file);
    });

    fileInput.addEventListener('change', e => {
      const file = e.target.files?.[0];
      if (file) handleFile(file);
    });

    function handleFile(file) {
      const ext = file.name.split('.').pop().toLowerCase();
      if (ext === 'txt') {
        const reader = new FileReader();
        reader.onload = e => { sourceText.value = e.target.result; };
        reader.readAsText(file);
      } else if (ext === 'pdf') {
        extractPdf(file);
      } else if (ext === 'docx' || ext === 'doc') {
        extractDocx(file);
      } else {
        alert('Unsupported file type. Please upload PDF, DOCX, or TXT.');
      }
    }

    async function extractPdf(file) {
      try {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        let text = '';
        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const content = await page.getTextContent();
          const strings = content.items.map(it => it.str);
          text += strings.join(' ') + "\n";
        }
        sourceText.value = text.trim();
      } catch (err) {
        console.error(err);
        alert('Error extracting text from PDF. You can convert it to TXT and upload again.');
      }
    }

    function extractDocx(file) {
      const reader = new FileReader();
      reader.onload = async e => {
        try {
          const arrayBuffer = e.target.result;
          const result = await window.mammoth.extractRawText({ arrayBuffer });
          sourceText.value = result.value.trim();
        } catch (err) {
          console.error(err);
          alert('Error extracting text from DOCX. You can convert it to TXT and upload again.');
        }
      };
      reader.readAsArrayBuffer(file);
    }

    function buildAdvancedInstructions() {
      const parts = [];
      const lang = advLanguage.value;
      const level = advLevel.value;
      const role = advRole.value.trim();
      const tone = advTone.value;

      if (lang === 'en') parts.push('Write the resume in English.');
      if (lang === 'ru') parts.push('Write the resume in Russian.');

      if (level === 'student') parts.push('Position the candidate as a student or entry-level specialist.');
      else if (level === 'mid') parts.push('Position the candidate as a mid-level professional.');
      else if (level === 'senior') parts.push('Position the candidate as a senior-level professional with leadership responsibilities.');

      if (role) parts.push(`Optimize the resume for the target role: "${role}" and include relevant keywords.`);

      if (tone === 'formal') parts.push('Use a formal corporate tone.');
      else if (tone === 'concise') parts.push('Make the writing extra concise and remove everything that does not add clear value.');
      else if (tone === 'neutral') parts.push('Use a neutral, modern professional tone.');

      return parts.join(' ');
    }

    async function callBackend(mode) {
      const resume = sourceText.value.trim();
      const userPrompt = promptInput.value.trim();
      const extra = buildAdvancedInstructions();
      const basePrompt =
        mode === "analyze"
          ? "–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–∏–ª—å–Ω—ã–µ –∏ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã —ç—Ç–æ–≥–æ —Ä–µ–∑—é–º–µ, –∑–∞—Ç–µ–º –ø—Ä–µ–¥–ª–æ–∂–∏ —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é."
          : MASTER_PROMPT;

      const prompt =
        (userPrompt || basePrompt) +
        (extra ? `\n\nAdditional requirements:\n${extra}` : "");

      if (!resume) {
        alert("Please paste or upload your resume text first.");
        return;
      }

      const activeBtn = mode === "analyze" ? analyzeBtn : generateBtn;
      activeBtn.disabled = true;
      activeBtn.textContent =
        mode === "analyze" ? "Analyzing..." : "Generating...";

      aiOutput.textContent =
        mode === "analyze"
          ? "AI is analyzing your resume..."
          : "AI is rewriting your resume...";

      try {
        const response = await fetch(`${BACKEND_URL}/api/chat`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ resume, prompt }),
        });

        if (!response.ok) {
          const errText = await response.text();
          aiOutput.textContent =
            "Backend returned an error:\n\n" + errText;
          return;
        }

        const data = await response.json();
        aiOutput.textContent = data.text || "No text field in backend response.";
      } catch (err) {
        console.error("Backend call error:", err);
        aiOutput.textContent =
          "Backend error. Check server or network connection.";
      } finally {
        activeBtn.disabled = false;
        activeBtn.textContent =
          mode === "analyze" ? "üîç Analyze" : "‚ú® Generate";
      }
    }

    analyzeBtn.addEventListener('click', () => callBackend('analyze'));
    generateBtn.addEventListener('click', () => callBackend('generate'));

    // Result actions
    btnCopy.addEventListener('click', async () => {
      const text = aiOutput.textContent || '';
      if (!text) return;
      try {
        await navigator.clipboard.writeText(text);
        alert('Copied to clipboard.');
      } catch (_) {
        alert('Could not copy. Select and copy manually.');
      }
    });

    btnDownload.addEventListener('click', () => {
      const text = aiOutput.textContent || '';
      const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'ai-resume.txt';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    btnEditToSource.addEventListener('click', () => {
      const text = aiOutput.textContent || '';
      if (!text) return;
      sourceText.value = text;
      sourceText.focus();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  </script>
</body>
</html>
