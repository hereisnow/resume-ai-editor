<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Resume Editor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #eef2ff 0, #f8fafc 45%, #e2e8f0 100%);
    }

    /* —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É ¬´—Ä–∞–±–æ—á–∏—Ö¬ª –±–ª–æ–∫–æ–≤, —á—Ç–æ–±—ã –Ω–µ –ø—Ä—ã–≥–∞–ª–∏ */
    .panel-shell {
      min-height: 560px;
    }

    textarea {
      resize: vertical;
    }

    /* –Ω–µ–±–æ–ª—å—à–∞—è —Ç–µ–Ω—å */
    .card-elevated {
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.12);
    }
  </style>
</head>
<body class="min-h-screen">

  <div id="root" class="min-h-screen flex flex-col">
    <header class="w-full border-b border-slate-200 bg-white/80 backdrop-blur">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 py-4 flex items-center justify-between">
        <div>
          <h1 class="text-2xl sm:text-3xl font-bold tracking-tight text-slate-900">
            AI Resume Editor
          </h1>
          <p class="mt-1 text-sm text-slate-500">
            Based on real needs of Reddit users ¬∑ Analyze an existing resume or generate a new one with AI.
          </p>
        </div>

        <!-- –º–∞–ª–µ–Ω—å–∫–∏–π ¬´–ª–µ–π–±–ª¬ª –ø—Ä–æ backend -->
        <div class="hidden sm:flex items-center gap-2 text-xs text-slate-500 bg-slate-100 px-3 py-1 rounded-full">
          <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
          <span>Gemini backend ¬∑ Render</span>
        </div>
      </div>
    </header>

    <main class="flex-1">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 py-8">

        <!-- ============ VIEW: LANDING (–¥–≤–µ –∫–∞—Ä—Ç–æ—á–∫–∏) ============ -->
        <section id="viewLanding" class="space-y-6">
          <h2 class="text-3xl sm:text-4xl font-bold text-slate-900">
            Choose your path
          </h2>
          <p class="text-slate-500 text-sm sm:text-base max-w-2xl">
            Upload your existing resume for a deep analysis, or generate a brand new ATS-friendly resume from a simple form.
          </p>

          <div class="grid md:grid-cols-2 gap-6 mt-4">
            <!-- Analyze card -->
            <button
              id="btnGoAnalyze"
              class="group relative w-full text-left p-6 sm:p-8 rounded-2xl border border-slate-200 bg-white card-elevated transition-all duration-200 hover:border-violet-300 hover:shadow-xl focus:outline-none"
            >
              <div class="flex items-start justify-between gap-4">
                <div>
                  <div class="inline-flex items-center justify-center rounded-xl bg-violet-100 text-violet-700 w-10 h-10 mb-3">
                    <!-- icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none"
                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M15 13a3 3 0 1 0-6 0a3 3 0 0 0 6 0"/>
                      <path d="M5 7h4l2 -3l2 3h4a2 2 0 0 1 2 2v9a2 2 0 0 1 -2 2H5a2 2 0 0 1 -2-2V9a2 2 0 0 1 2-2Z"/>
                    </svg>
                  </div>
                  <h3 class="text-xl font-semibold text-slate-900">
                    Analyze Resume
                  </h3>
                  <p class="mt-2 text-sm text-slate-500 leading-relaxed">
                    Upload your existing resume for a detailed analysis of strengths, weaknesses, ATS-compatibility,
                    and improvement suggestions with concrete metrics.
                  </p>
                </div>
                <div class="mt-1 text-slate-400 group-hover:text-violet-500 transition-transform group-hover:translate-x-0.5">
                  <!-- arrow -->
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M5 12h14"/>
                    <path d="M13 18l6-6l-6-6"/>
                  </svg>
                </div>
              </div>

              <div class="mt-4 flex flex-wrap gap-2">
                <span class="px-2.5 py-1 text-xs font-medium bg-slate-100 text-slate-600 rounded-full">
                  PDF / DOCX / TXT
                </span>
                <span class="px-2.5 py-1 text-xs font-medium bg-slate-100 text-slate-600 rounded-full">
                  ATS Check
                </span>
                <span class="px-2.5 py-1 text-xs font-medium bg-slate-100 text-slate-600 rounded-full">
                  Grammar &amp; Achievements
                </span>
              </div>
            </button>

            <!-- Generate card -->
            <button
              id="btnGoGenerate"
              class="group relative w-full text-left p-6 sm:p-8 rounded-2xl border border-slate-200 bg-white card-elevated transition-all duration-200 hover:border-sky-300 hover:shadow-xl focus:outline-none"
            >
              <div class="flex items-start justify-between gap-4">
                <div>
                  <div class="inline-flex items-center justify-center rounded-xl bg-sky-100 text-sky-700 w-10 h-10 mb-3">
                    <!-- icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none"
                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M12 3v18"/>
                      <path d="M5 10h7"/>
                      <path d="M5 14h7"/>
                      <path d="M15 7h4"/>
                      <path d="M15 11h4"/>
                      <path d="M15 15h4"/>
                    </svg>
                  </div>
                  <h3 class="text-xl font-semibold text-slate-900">
                    Generate Resume
                  </h3>
                  <p class="mt-2 text-sm text-slate-500 leading-relaxed">
                    Fill in a few fields (target role, skills, experience notes), and let AI build a clean,
                    ATS-friendly resume from scratch.
                  </p>
                </div>
                <div class="mt-1 text-slate-400 group-hover:text-sky-500 transition-transform group-hover:translate-x-0.5">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M5 12h14"/>
                    <path d="M13 18l6-6l-6-6"/>
                  </svg>
                </div>
              </div>

              <div class="mt-4 flex flex-wrap gap-2">
                <span class="px-2.5 py-1 text-xs font-medium bg-slate-100 text-slate-600 rounded-full">
                  Simple form
                </span>
                <span class="px-2.5 py-1 text-xs font-medium bg-slate-100 text-slate-600 rounded-full">
                  AI-Powered
                </span>
              </div>
            </button>
          </div>
        </section>

        <!-- ============ VIEW: ANALYZE ============ -->
        <section id="viewAnalyze" class="hidden mt-4">
          <div class="flex items-center justify-between mb-4">
            <div>
              <h2 class="text-2xl font-semibold text-slate-900">Analyze Resume</h2>
              <p class="text-sm text-slate-500">
                Upload or paste your resume, configure options, then click <span class="font-medium">Analyze</span> or
                <span class="font-medium">Generate</span>.
              </p>
            </div>
            <button
              id="btnBackFromAnalyze"
              class="inline-flex items-center gap-1 text-xs text-slate-500 hover:text-slate-700 px-3 py-1.5 rounded-full border border-slate-200 bg-white"
            >
              <span>‚Üê Back</span>
            </button>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- LEFT -->
            <section class="bg-white rounded-2xl border border-slate-200 card-elevated panel-shell flex flex-col">
              <header class="flex items-center justify-between px-5 pt-4 pb-3 border-b border-slate-100">
                <div>
                  <h3 class="text-sm font-semibold text-slate-900">Source Resume</h3>
                  <p class="text-xs text-slate-500">
                    Drag &amp; drop PDF / DOCX / TXT or paste text below.
                  </p>
                </div>
                <button
                  id="btnToggleATS"
                  class="text-[11px] font-medium text-violet-600 bg-violet-50 border border-violet-100 px-2.5 py-1 rounded-full"
                >
                  ATS Scan View
                </button>
              </header>

              <div class="p-5 space-y-3 flex-1 flex flex-col">
                <!-- dropzone -->
                <div
                  id="dropzone"
                  class="border-2 border-dashed border-slate-200 rounded-xl bg-slate-50 px-4 py-6 text-center text-xs text-slate-500 cursor-pointer hover:border-violet-300 hover:bg-violet-50 transition-colors"
                >
                  <div class="font-medium text-slate-700 mb-1">Drag &amp; Drop PDF, DOCX, TXT</div>
                  <div>Max: PDF 5MB, DOCX 3MB ¬∑ or click to browse</div>
                </div>
                <input id="fileInput" type="file" accept=".pdf,.doc,.docx,.txt" class="hidden" />

                <!-- textarea -->
                <textarea
                  id="sourceText"
                  class="mt-2 w-full flex-1 min-h-[220px] text-xs sm:text-sm border border-slate-200 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-violet-300 focus:border-violet-400"
                  placeholder="Extracted resume text will appear here... You can also paste text directly."
                ></textarea>

                <p class="text-[11px] text-slate-500">
                  Make sure the text looks clean before sending it to AI.
                </p>

                <!-- prompt + chips -->
                <div class="space-y-2">
                  <input
                    id="prompt"
                    type="text"
                    class="w-full text-xs sm:text-sm border border-slate-200 rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-violet-300 focus:border-violet-400"
                    placeholder="E.g., Rewrite for a Product Manager role in Germany. Focus on achievements and metrics."
                  />
                  <div class="flex flex-wrap gap-2">
                    <button
                      id="chipGrammar"
                      type="button"
                      class="px-3 py-1 text-[11px] rounded-full bg-slate-100 text-slate-700"
                    >
                      Fix Grammar
                    </button>
                    <button
                      id="chipTone"
                      type="button"
                      class="px-3 py-1 text-[11px] rounded-full bg-slate-100 text-slate-700"
                    >
                      Professional Tone
                    </button>
                    <button
                      id="chipMetrics"
                      type="button"
                      class="px-3 py-1 text-[11px] rounded-full bg-slate-100 text-slate-700"
                    >
                      Add Metrics
                    </button>
                  </div>
                </div>

                <!-- advanced -->
                <details class="mt-2 text-xs text-slate-600 border border-dashed border-slate-200 rounded-xl px-3 py-2">
                  <summary class="cursor-pointer select-none text-[11px] font-semibold text-slate-500">
                    Advanced settings
                  </summary>
                  <div class="mt-2 grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div class="space-y-1">
                      <label class="text-[11px] text-slate-500">Target language</label>
                      <select
                        id="advLanguage"
                        class="w-full border border-slate-200 rounded-full px-3 py-1.5 text-xs focus:outline-none focus:ring-2 focus:ring-violet-300 focus:border-violet-400"
                      >
                        <option value="en" selected>English</option>
                        <option value="ru">Russian</option>
                      </select>
                    </div>
                    <div class="space-y-1">
                      <label class="text-[11px] text-slate-500">Career level</label>
                      <select
                        id="advLevel"
                        class="w-full border border-slate-200 rounded-full px-3 py-1.5 text-xs focus:outline-none focus:ring-2 focus:ring-violet-300 focus:border-violet-400"
                      >
                        <option value="student">Student / Entry</option>
                        <option value="mid">Mid-level</option>
                        <option value="senior" selected>Senior</option>
                      </select>
                    </div>
                    <div class="space-y-1">
                      <label class="text-[11px] text-slate-500">Target role (optional)</label>
                      <input
                        id="advRole"
                        type="text"
                        class="w-full border border-slate-200 rounded-full px-3 py-1.5 text-xs focus:outline-none focus:ring-2 focus:ring-violet-300 focus:border-violet-400"
                        placeholder="e.g. Product Manager"
                      />
                    </div>
                    <div class="space-y-1">
                      <label class="text-[11px] text-slate-500">Tone</label>
                      <select
                        id="advTone"
                        class="w-full border border-slate-200 rounded-full px-3 py-1.5 text-xs focus:outline-none focus:ring-2 focus:ring-violet-300 focus:border-violet-400"
                      >
                        <option value="neutral" selected>Neutral professional</option>
                        <option value="formal">Formal</option>
                        <option value="concise">Extra concise</option>
                      </select>
                    </div>
                  </div>
                </details>

                <!-- buttons -->
                <div class="mt-3 flex justify-end gap-3">
                  <button
                    id="analyzeBtn"
                    type="button"
                    class="inline-flex items-center justify-center gap-1 rounded-full bg-violet-600 text-white text-sm px-5 py-2 shadow hover:bg-violet-700 disabled:opacity-70"
                  >
                    üîç Analyze
                  </button>
                  <button
                    id="generateBtn"
                    type="button"
                    class="inline-flex items-center justify-center gap-1 rounded-full bg-sky-600 text-white text-sm px-5 py-2 shadow hover:bg-sky-700 disabled:opacity-70"
                  >
                    ‚ú® Generate
                  </button>
                </div>
              </div>
            </section>

            <!-- RIGHT -->
            <section class="bg-white rounded-2xl border border-slate-200 card-elevated panel-shell flex flex-col">
              <header class="flex items-center justify-between px-5 pt-4 pb-3 border-b border-slate-100">
                <h3 class="text-sm font-semibold text-slate-900">AI Result</h3>
                <div class="flex items-center gap-2">
                  <button
                    id="btnCopy"
                    type="button"
                    class="w-7 h-7 flex items-center justify-center rounded-full border border-slate-200 text-slate-500 hover:bg-slate-50 text-xs"
                    title="Copy to clipboard"
                  >
                    üìã
                  </button>
                  <button
                    id="btnDownload"
                    type="button"
                    class="w-7 h-7 flex items-center justify-center rounded-full border border-slate-200 text-slate-500 hover:bg-slate-50 text-xs"
                    title="Download TXT"
                  >
                    üìÑ
                  </button>
                  <button
                    id="btnEditToSource"
                    type="button"
                    class="w-7 h-7 flex items-center justify-center rounded-full border border-slate-200 text-slate-500 hover:bg-slate-50 text-xs"
                    title="Send back to source"
                  >
                    ‚úèÔ∏è
                  </button>
                </div>
              </header>
              <div
                id="aiOutput"
                class="flex-1 text-xs sm:text-sm text-slate-700 px-5 py-4 whitespace-pre-wrap overflow-auto bg-slate-50 rounded-b-2xl"
              >
                AI generated content will appear here...
              </div>
            </section>
          </div>
        </section>

        <!-- ============ VIEW: GENERATE ============ -->
        <section id="viewGenerate" class="hidden mt-4">
          <div class="flex items-center justify-between mb-4">
            <div>
              <h2 class="text-2xl font-semibold text-slate-900">Generate Resume</h2>
              <p class="text-sm text-slate-500">
                Fill in the basics, hit <span class="font-medium">Generate Resume</span>, and AI will craft an ATS-ready resume.
              </p>
            </div>
            <button
              id="btnBackFromGenerate"
              class="inline-flex items-center gap-1 text-xs text-slate-500 hover:text-slate-700 px-3 py-1.5 rounded-full border border-slate-200 bg-white"
            >
              <span>‚Üê Back</span>
            </button>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- LEFT: simple form -->
            <section class="bg-white rounded-2xl border border-slate-200 card-elevated panel-shell flex flex-col">
              <header class="px-5 pt-4 pb-3 border-b border-slate-100">
                <h3 class="text-sm font-semibold text-slate-900">Generate Resume</h3>
                <p class="text-xs text-slate-500">
                  Just a lightweight form ‚Äî you can refine the result later in the Analyze tab.
                </p>
              </header>

              <div class="p-5 space-y-4 flex-1 flex flex-col">
                <div class="space-y-1">
                  <label class="text-[11px] text-slate-500">Target Role *</label>
                  <input
                    id="genRole"
                    type="text"
                    class="w-full border border-slate-200 rounded-xl px-3 py-2 text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-sky-300 focus:border-sky-400"
                    placeholder="e.g. Product Manager"
                  />
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                  <div class="space-y-1">
                    <label class="text-[11px] text-slate-500">Level</label>
                    <select
                      id="genLevel"
                      class="w-full border border-slate-200 rounded-xl px-3 py-2 text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-sky-300 focus:border-sky-400"
                    >
                      <option value="entry">Entry level</option>
                      <option value="mid" selected>Mid-level</option>
                      <option value="senior">Senior</option>
                    </select>
                  </div>
                  <div class="space-y-1">
                    <label class="text-[11px] text-slate-500">Location (optional)</label>
                    <input
                      id="genLocation"
                      type="text"
                      class="w-full border border-slate-200 rounded-xl px-3 py-2 text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-sky-300 focus:border-sky-400"
                      placeholder="e.g. Berlin, Germany"
                    />
                  </div>
                </div>

                <div class="space-y-1">
                  <label class="text-[11px] text-slate-500">Skills</label>
                  <textarea
                    id="genSkills"
                    class="w-full border border-slate-200 rounded-xl px-3 py-2 text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-sky-300 focus:border-sky-400 min-h-[70px]"
                    placeholder="e.g. Product discovery, A/B testing, SQL, Google Analytics, UX research..."
                  ></textarea>
                </div>

                <div class="space-y-1">
                  <label class="text-[11px] text-slate-500">Experience (brief notes)</label>
                  <textarea
                    id="genExperience"
                    class="w-full border border-slate-200 rounded-xl px-3 py-2 text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-sky-300 focus:border-sky-400 min-h-[80px]"
                    placeholder="e.g. 3 years as Head of Customer Support, improved CSAT by 15%, launched new payment product..."
                  ></textarea>
                </div>

                <div class="space-y-1">
                  <label class="text-[11px] text-slate-500">Education</label>
                  <input
                    id="genEducation"
                    type="text"
                    class="w-full border border-slate-200 rounded-xl px-3 py-2 text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-sky-300 focus:border-sky-400"
                    placeholder="e.g. Bachelor‚Äôs Degree in Project Management, Vilnius University, 2016"
                  />
                </div>

                <div class="pt-2 flex justify-end">
                  <button
                    id="btnGenerateResume"
                    type="button"
                    class="inline-flex items-center justify-center gap-1 rounded-full bg-sky-600 text-white text-sm px-5 py-2 shadow hover:bg-sky-700 disabled:opacity-70"
                  >
                    ‚ö° Generate Resume
                  </button>
                </div>
              </div>
            </section>

            <!-- RIGHT: result -->
            <section class="bg-white rounded-2xl border border-slate-200 card-elevated panel-shell flex flex-col">
              <header class="flex items-center justify-between px-5 pt-4 pb-3 border-b border-slate-100">
                <h3 class="text-sm font-semibold text-slate-900">Generated Resume</h3>
                <button
                  id="btnCopyGenerated"
                  type="button"
                  class="w-7 h-7 flex items-center justify-center rounded-full border border-slate-200 text-slate-500 hover:bg-slate-50 text-xs"
                >
                  üìã
                </button>
              </header>
              <div
                id="generatedOutput"
                class="flex-1 text-xs sm:text-sm text-slate-700 px-5 py-4 whitespace-pre-wrap overflow-auto bg-slate-50 rounded-b-2xl"
              >
                Generated resume will appear here. Fill the form and click ‚ÄúGenerate Resume‚Äù.
              </div>
            </section>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- pdf.js + mammoth for PDF/DOCX -->
  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  <script type="module">
    import * as pdfjsLib from "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.min.mjs";

    const BACKEND_URL = "https://resume-ai-editor-backend.onrender.com";

    // --------- View switching ---------
    const viewLanding = document.getElementById("viewLanding");
    const viewAnalyze = document.getElementById("viewAnalyze");
    const viewGenerate = document.getElementById("viewGenerate");

    const btnGoAnalyze = document.getElementById("btnGoAnalyze");
    const btnGoGenerate = document.getElementById("btnGoGenerate");
    const btnBackFromAnalyze = document.getElementById("btnBackFromAnalyze");
    const btnBackFromGenerate = document.getElementById("btnBackFromGenerate");

    function showView(name) {
      viewLanding.classList.add("hidden");
      viewAnalyze.classList.add("hidden");
      viewGenerate.classList.add("hidden");

      if (name === "landing") viewLanding.classList.remove("hidden");
      if (name === "analyze") viewAnalyze.classList.remove("hidden");
      if (name === "generate") viewGenerate.classList.remove("hidden");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    btnGoAnalyze.addEventListener("click", () => showView("analyze"));
    btnGoGenerate.addEventListener("click", () => showView("generate"));
    btnBackFromAnalyze.addEventListener("click", () => showView("landing"));
    btnBackFromGenerate.addEventListener("click", () => showView("landing"));

    // --------- Analyze view logic ---------
    const dropzone = document.getElementById("dropzone");
    const fileInput = document.getElementById("fileInput");
    const sourceText = document.getElementById("sourceText");
    const promptInput = document.getElementById("prompt");
    const aiOutput = document.getElementById("aiOutput");
    const analyzeBtn = document.getElementById("analyzeBtn");
    const generateBtn = document.getElementById("generateBtn");

    const advLanguage = document.getElementById("advLanguage");
    const advLevel = document.getElementById("advLevel");
    const advRole = document.getElementById("advRole");
    const advTone = document.getElementById("advTone");

    const chipGrammar = document.getElementById("chipGrammar");
    const chipTone = document.getElementById("chipTone");
    const chipMetrics = document.getElementById("chipMetrics");

    const btnCopy = document.getElementById("btnCopy");
    const btnDownload = document.getElementById("btnDownload");
    const btnEditToSource = document.getElementById("btnEditToSource");

    const MASTER_PROMPT = `–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–π –º–æ—ë —Ä–µ–∑—é–º–µ –ø–æ —Å–ª–µ–¥—É—é—â–µ–º—É –≤—ã—Å–æ–∫–æ–¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É –∑–∞–¥–∞–Ω–∏—é.
–†–∞–±–æ—Ç–∞–π —Å—Ç—Ä–æ–≥–æ –ø–æ –ø—É–Ω–∫—Ç–∞–º.

## 1. –û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å—Ç–∏–ª—é –∏ –∫–∞—á–µ—Å—Ç–≤—É —Ç–µ–∫—Å—Ç–∞
* –ü—Ä–∏–≤–µ–¥–∏ —Ç–µ–∫—Å—Ç –∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º—É –¥–µ–ª–æ–≤–æ–º—É —Å—Ç–∏–ª—é.
* –ü–∏—à–∏ —è—Å–Ω–æ, –ª–∞–∫–æ–Ω–∏—á–Ω–æ, –±–µ–∑ –≤–æ–¥—ã –∏ –±–µ–∑ –æ–±—â–∏—Ö —Ñ—Ä–∞–∑.
* –£–±–∏—Ä–∞–π –ø–∞—Å—Å–∏–≤–Ω—ã–π –∑–∞–ª–æ–≥, –∏—Å–ø–æ–ª—å–∑—É–π –∞–∫—Ç–∏–≤–Ω—ã–π.
* –ù–∞—á–∏–Ω–∞–π –∫–∞–∂–¥—ã–π –±—É–ª–ª–µ—Ç —Å —Å–∏–ª—å–Ω–æ–≥–æ –≥–ª–∞–≥–æ–ª–∞ –¥–µ–π—Å—Ç–≤–∏—è (Led, Delivered, Designed, Optimized –∏ –¥—Ä.).
* –ò–∑–±–µ–≥–∞–π –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–ª–æ–≤ –∏ –∫–ª–∏—à–µ.
* –î–µ–ª–∞–π —Ç–µ–∫—Å—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –ø–æ–ª—å–∑—É –¥–ª—è —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è.

## 2. –£–ª—É—á—à–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
* –î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—Ç–∞ —Ä–∞–±–æ—Ç—ã:
  - –ü—Ä–µ–æ–±—Ä–∞–∑—É–π –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.
  - –î–æ–±–∞–≤—å –º–µ—Ç—Ä–∏–∫–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–ø—Ä–µ–¥–ª–æ–∂–∏ —Ç–∏–ø–∏—á–Ω—ã–µ KPI, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã).
  - –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ç—Ä–∏ –≤–æ–ø—Ä–æ—Å–∞: –∫–∞–∫—É—é –∑–∞–¥–∞—á—É —è —Ä–µ—à–∞–ª, —á—Ç–æ —Å–¥–µ–ª–∞–ª, –∫–∞–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±–µ—Å–ø–µ—á–∏–ª.
  - –£–∫–∞–∂–∏ –º–∞—Å—à—Ç–∞–±—ã: –±—é–¥–∂–µ—Ç—ã, –∫–æ–º–∞–Ω–¥—ã, –æ–±—ä—ë–º—ã, —Å—Ä–æ–∫–∏, —Ä–æ—Å—Ç, —Å–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—å, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

## 3. ATS-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
* –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç, –±–µ–∑ —Å–ª–æ–∂–Ω–æ–π –≤—ë—Ä—Å—Ç–∫–∏.
* –ü—Ä–∏–º–µ–Ω—è–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –º–æ–µ–π —Å—Ñ–µ—Ä—ã: –Ω–∞–≤—ã–∫–∏, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –º–µ—Ç–æ–¥—ã, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, —Ä–æ–ª–∏.
* –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
  - Summary
  - Skills
  - Experience
  - Education
  - Certifications
  - Tools/Tech
  - Projects
  - Additional info
* –ò—Å–∫–ª—é—á–∏ —Ç–∞–±–ª–∏—Ü—ã, —Å—Ç–æ–ª–±—Ü—ã, –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏ —ç–º–æ–¥–∑–∏.

## 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏—Ç–æ–≥–æ–≤–æ–≥–æ —Ä–µ–∑—é–º–µ
* Professional Summary (3‚Äì4 —Å—Ç—Ä–æ–∫–∏).
* Core Skills / Technical Skills ‚Äî –Ω–∞–≤—ã–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.
* Experience ‚Äî –¥–æ–ª–∂–Ω–æ—Å—Ç—å, –∫–æ–º–ø–∞–Ω–∏—è, –¥–∞—Ç—ã + 4‚Äì6 –±—É–ª–ª–µ—Ç–æ–≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π.
* Education ‚Äî —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–∏–º–æ–µ.
* Projects (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
* Certifications / Courses / Tech Stack.
* Additional Information ‚Äî —è–∑—ã–∫–∏, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, soft skills.

## 5. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
* –í –∫–æ–Ω—Ü–µ –∫—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏, —á—Ç–æ –±—ã–ª–æ –ø–ª–æ—Ö–æ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Ç–µ–∫—Å—Ç–µ –∏ —á—Ç–æ —Ç—ã —É–ª—É—á—à–∏–ª.`;

    function appendPrompt(text) {
      const current = promptInput.value.trim();
      promptInput.value = current ? current + " ¬∑ " + text : text;
      promptInput.focus();
    }

    chipGrammar.addEventListener("click", () => appendPrompt("Fix grammar and clarity."));
    chipTone.addEventListener("click", () => appendPrompt("Use a confident, professional tone."));
    chipMetrics.addEventListener("click", () => appendPrompt("Add concrete metrics and impact (%, $, time saved)."));

    // drag & drop
    ["dragenter", "dragover"].forEach(evt => {
      dropzone.addEventListener(evt, e => {
        e.preventDefault();
        e.stopPropagation();
        dropzone.classList.add("border-violet-400", "bg-violet-50");
      });
    });
    ["dragleave", "drop"].forEach(evt => {
      dropzone.addEventListener(evt, e => {
        e.preventDefault();
        e.stopPropagation();
        dropzone.classList.remove("border-violet-400", "bg-violet-50");
      });
    });

    dropzone.addEventListener("click", () => fileInput.click());
    dropzone.addEventListener("drop", e => {
      const file = e.dataTransfer.files?.[0];
      if (file) handleFile(file);
    });
    fileInput.addEventListener("change", e => {
      const file = e.target.files?.[0];
      if (file) handleFile(file);
    });

    function handleFile(file) {
      const ext = file.name.split(".").pop().toLowerCase();
      if (ext === "txt") {
        const reader = new FileReader();
        reader.onload = e => {
          sourceText.value = e.target.result;
        };
        reader.readAsText(file);
      } else if (ext === "pdf") {
        extractPdf(file);
      } else if (ext === "docx" || ext === "doc") {
        extractDocx(file);
      } else {
        alert("Unsupported file type. Please upload PDF, DOCX, or TXT.");
      }
    }

    async function extractPdf(file) {
      try {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        let text = "";
        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const content = await page.getTextContent();
          const strings = content.items.map(it => it.str);
          text += strings.join(" ") + "\n";
        }
        sourceText.value = text.trim();
      } catch (err) {
        console.error(err);
        alert("Error extracting text from PDF. You can convert it to TXT and upload again.");
      }
    }

    function extractDocx(file) {
      const reader = new FileReader();
      reader.onload = async e => {
        try {
          const arrayBuffer = e.target.result;
          const result = await window.mammoth.extractRawText({ arrayBuffer });
          sourceText.value = result.value.trim();
        } catch (err) {
          console.error(err);
          alert("Error extracting text from DOCX. You can convert it to TXT and upload again.");
        }
      };
      reader.readAsArrayBuffer(file);
    }

    function buildAdvancedInstructions() {
      const parts = [];
      const lang = advLanguage.value;
      const level = advLevel.value;
      const role = advRole.value.trim();
      const tone = advTone.value;

      if (lang === "en") parts.push("Write the resume in English.");
      if (lang === "ru") parts.push("Write the resume in Russian.");

      if (level === "student") parts.push("Position the candidate as a student or entry-level specialist.");
      else if (level === "mid") parts.push("Position the candidate as a mid-level professional.");
      else if (level === "senior")
        parts.push("Position the candidate as a senior-level professional with leadership responsibilities.");

      if (role) parts.push(`Optimize the resume for the target role: "${role}" and include relevant keywords.`);

      if (tone === "formal") parts.push("Use a formal corporate tone.");
      else if (tone === "concise")
        parts.push("Make the writing extra concise and remove everything that does not add clear value.");
      else if (tone === "neutral") parts.push("Use a neutral, modern professional tone.");

      return parts.join(" ");
    }

    async function callBackend(mode, payload, targetElement, button) {
      try {
        button.disabled = true;
        targetElement.textContent =
          mode === "generate"
            ? "AI is rewriting your resume..."
            : mode === "gen-resume"
            ? "AI is generating a new resume..."
            : "AI is analyzing your resume...";

        const response = await fetch(`${BACKEND_URL}/api/chat`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          const errText = await response.text();
          targetElement.textContent = "Backend returned an error:\n\n" + errText;
          return;
        }

        const data = await response.json();
        targetElement.textContent = data.text || "No text field in backend response.";
      } catch (err) {
        console.error(err);
        targetElement.textContent = "Network or backend error. Try again later.";
      } finally {
        button.disabled = false;
      }
    }

    async function runAnalyze(mode) {
      const resume = sourceText.value.trim();
      if (!resume) {
        alert("Please paste or upload your resume text first.");
        return;
      }

      const userPrompt = promptInput.value.trim();
      const extra = buildAdvancedInstructions();
      const basePrompt =
        mode === "analyze"
          ? "–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–∏–ª—å–Ω—ã–µ –∏ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã —ç—Ç–æ–≥–æ —Ä–µ–∑—é–º–µ, –∑–∞—Ç–µ–º –ø—Ä–µ–¥–ª–æ–∂–∏ —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é."
          : MASTER_PROMPT;

      const finalPrompt =
        (userPrompt || basePrompt) + (extra ? `\n\nAdditional requirements:\n${extra}` : "");

      const activeBtn = mode === "analyze" ? analyzeBtn : generateBtn;
      await callBackend(
        mode,
        { resume, prompt: finalPrompt },
        aiOutput,
        activeBtn
      );
    }

    analyzeBtn.addEventListener("click", () => runAnalyze("analyze"));
    generateBtn.addEventListener("click", () => runAnalyze("generate"));

    // result actions
    btnCopy.addEventListener("click", async () => {
      const text = aiOutput.textContent || "";
      if (!text) return;
      try {
        await navigator.clipboard.writeText(text);
        alert("Copied to clipboard.");
      } catch {
        alert("Could not copy. Select and copy manually.");
      }
    });

    btnDownload.addEventListener("click", () => {
      const text = aiOutput.textContent || "";
      const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "ai-resume.txt";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    btnEditToSource.addEventListener("click", () => {
      const text = aiOutput.textContent || "";
      if (!text) return;
      sourceText.value = text;
      showView("analyze");
      sourceText.focus();
    });

    // --------- Generate view logic ---------
    const genRole = document.getElementById("genRole");
    const genLevel = document.getElementById("genLevel");
    const genLocation = document.getElementById("genLocation");
    const genSkills = document.getElementById("genSkills");
    const genExperience = document.getElementById("genExperience");
    const genEducation = document.getElementById("genEducation");
    const btnGenerateResume = document.getElementById("btnGenerateResume");
    const generatedOutput = document.getElementById("generatedOutput");
    const btnCopyGenerated = document.getElementById("btnCopyGenerated");

    btnGenerateResume.addEventListener("click", async () => {
      const role = genRole.value.trim();
      if (!role) {
        alert("Please specify target role at least.");
        return;
      }

      const formSummary = `
Target role: ${role}
Level: ${genLevel.value}
Location: ${genLocation.value || "N/A"}

Skills:
${genSkills.value.trim() || "N/A"}

Experience notes:
${genExperience.value.trim() || "N/A"}

Education:
${genEducation.value.trim() || "N/A"}
`.trim();

      const promptForGeneration = `
You are an expert resume writer.

Using ONLY the structured information below, generate a full, ATS-friendly resume from scratch.
Write in clear, concise English, with strong action verbs and metrics where reasonable.

Return the resume in plain text with sections:
Summary, Skills, Experience, Education, Additional info (optional).

${formSummary}
`.trim();

      await callBackend(
        "gen-resume",
        { resume: formSummary, prompt: promptForGeneration },
        generatedOutput,
        btnGenerateResume
      );
    });

    btnCopyGenerated.addEventListener("click", async () => {
      const text = generatedOutput.textContent || "";
      if (!text) return;
      try {
        await navigator.clipboard.writeText(text);
        alert("Copied generated resume.");
      } catch {
        alert("Could not copy. Select and copy manually.");
      }
    });

    // —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω
    showView("landing");
  </script>
</body>
</html>
