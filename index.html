<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Resume Editor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 text-slate-900">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 py-6 sm:py-10">
    <!-- HEADER -->
    <header class="mb-6 sm:mb-8 flex items-center justify-between gap-4">
      <div>
        <h1 class="text-xl sm:text-2xl font-bold tracking-tight">
          AI Resume Editor
        </h1>
        <p class="text-xs sm:text-sm text-slate-500">
          Analyze an existing resume or generate a new one in three simple steps.
        </p>
      </div>
    </header>

    <!-- STEPPER -->
    <nav aria-label="Progress" class="mb-6">
      <ol class="flex items-center gap-4 text-[11px] sm:text-xs font-medium text-slate-500">
        <li class="flex items-center gap-2" data-step="1">
          <span class="step-circle flex items-center justify-center w-6 h-6 rounded-full border text-[11px] bg-indigo-500 border-indigo-500 text-white">
            1
          </span>
          <span class="step-label">Choose mode</span>
        </li>
        <li class="flex-1 h-px bg-slate-200"></li>
        <li class="flex items-center gap-2" data-step="2">
          <span class="step-circle flex items-center justify-center w-6 h-6 rounded-full border text-[11px] bg-white border-slate-300 text-slate-500">
            2
          </span>
          <span class="step-label">Fill details</span>
        </li>
        <li class="flex-1 h-px bg-slate-200"></li>
        <li class="flex items-center gap-2" data-step="3">
          <span class="step-circle flex items-center justify-center w-6 h-6 rounded-full border text-[11px] bg-white border-slate-300 text-slate-500">
            3
          </span>
          <span class="step-label">Review &amp; export</span>
        </li>
      </ol>
    </nav>

    <!-- MODE PICKER (STEP 1) -->
    <section id="mode-picker" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <!-- Generate card -->
      <button
        type="button"
        data-mode="generate"
        class="mode-card group relative flex flex-col items-start gap-2 rounded-2xl border border-slate-200 bg-white/80 px-4 py-4 text-left shadow-sm hover:shadow-md hover:border-indigo-200 transition"
      >
        <div class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-2.5 py-1 text-[11px] text-slate-700">
          <span>Generate resume</span>
        </div>
        <h2 class="text-sm sm:text-base font-semibold text-slate-900">
          Create a new professional resume
        </h2>
        <p class="text-xs sm:text-[13px] text-slate-500">
          Fill a short form and let AI create a clean, ATS-friendly resume.
        </p>
        <div class="mt-2 flex flex-wrap gap-2 text-[10px] text-slate-600">
          <span class="rounded-full bg-slate-100 px-2 py-1">AI-assisted</span>
          <span class="rounded-full bg-slate-100 px-2 py-1">Best for starting from scratch</span>
        </div>
        <span class="absolute right-3 top-3 text-xs text-indigo-400 group-hover:translate-x-0.5 transition">
          Start →
        </span>
      </button>

      <!-- Analyze card -->
      <button
        type="button"
        data-mode="analyze"
        class="mode-card group relative flex flex-col items-start gap-2 rounded-2xl border border-slate-200 bg-white/80 px-4 py-4 text-left shadow-sm hover:shadow-md hover:border-indigo-200 transition"
      >
        <div class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-2.5 py-1 text-[11px] text-slate-700">
          <span>Analyze resume</span>
        </div>
        <h2 class="text-sm sm:text-base font-semibold text-slate-900">
          Improve an existing resume
        </h2>
        <p class="text-xs sm:text-[13px] text-slate-500">
          Upload or paste your resume to get a review and concrete suggestions.
        </p>
        <div class="mt-2 flex flex-wrap gap-2 text-[10px] text-slate-600">
          <span class="rounded-full bg-slate-100 px-2 py-1">ATS check</span>
          <span class="rounded-full bg-slate-100 px-2 py-1">Grammar &amp; style</span>
          <span class="rounded-full bg-slate-100 px-2 py-1">Impact &amp; metrics</span>
        </div>
        <span class="absolute right-3 top-3 text-xs text-slate-400 group-hover:translate-x-0.5 transition">
          Start →
        </span>
      </button>
    </section>

    <!-- GENERATE WORKSPACE -->
    <section id="generate-panel" class="mb-8 hidden">
      <div class="mb-4 flex items-center justify-between gap-3">
        <div>
          <h2 class="text-sm sm:text-base font-semibold text-slate-900">
            Generate Resume
          </h2>
          <p class="text-xs sm:text-[13px] text-slate-500">
            Fill the form on the left. Click “Generate resume” to update the preview on the right.
          </p>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-5">
        <!-- FORM -->
        <form id="generate-form" class="space-y-4 bg-white/80 border border-slate-200 rounded-2xl p-4 shadow-sm">
          <div>
            <label class="flex items-center justify-between text-xs font-medium text-slate-700 mb-1">
              <span>Contact info</span>
              <span class="text-[11px] text-slate-400">Name, email, LinkedIn</span>
            </label>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
              <input
                id="g-fullname"
                class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none"
                placeholder="John Doe"
              />
              <input
                id="g-contact"
                class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none"
                placeholder="john@example.com · linkedin.com/in/john"
              />
            </div>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
            <div>
              <label class="flex items-center justify-between text-xs font-medium text-slate-700 mb-1">
                <span>Target role *</span>
              </label>
              <input
                id="g-role"
                required
                class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none"
                placeholder="e.g. Product Manager"
              />
            </div>
            <div>
              <label class="flex items-center justify-between text-xs font-medium text-slate-700 mb-1">
                <span>Level</span>
              </label>
              <select
                id="g-level"
                class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none"
              >
                <option>Junior</option>
                <option selected>Mid-level</option>
                <option>Senior</option>
                <option>Lead</option>
              </select>
            </div>
          </div>

          <div>
            <label class="flex items-center justify-between text-xs font-medium text-slate-700 mb-1">
              <span>Professional summary</span>
            </label>
            <textarea
              id="g-summary"
              rows="3"
              class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none"
              placeholder="Short 2–3 sentence summary about your background and goals."
            ></textarea>
          </div>

          <div>
            <label class="flex items-center justify-between text-xs font-medium text-slate-700 mb-1">
              <span>Skills</span>
              <span class="text-[11px] text-slate-400">Press Enter to add a skill</span>
            </label>
            <div
              id="g-skills-wrapper"
              class="flex flex-wrap items-center gap-1 rounded-xl border border-slate-200 bg-slate-50 px-2 py-1 cursor-text"
            >
              <!-- default tags -->
              <span class="skill-tag inline-flex items-center gap-1 rounded-full bg-slate-200/80 px-2 py-0.5 text-[11px] text-slate-700">
                <span>JavaScript</span>
                <button type="button" class="skill-remove ml-1 text-[11px] text-slate-500 hover:text-slate-800">×</button>
              </span>
              <span class="skill-tag inline-flex items-center gap-1 rounded-full bg-slate-200/80 px-2 py-0.5 text-[11px] text-slate-700">
                <span>React</span>
                <button type="button" class="skill-remove ml-1 text-[11px] text-slate-500 hover:text-slate-800">×</button>
              </span>
              <span class="skill-tag inline-flex items-center gap-1 rounded-full bg-slate-200/80 px-2 py-0.5 text-[11px] text-slate-700">
                <span>SQL</span>
                <button type="button" class="skill-remove ml-1 text-[11px] text-slate-500 hover:text-slate-800">×</button>
              </span>
              <input
                id="g-skills-input"
                class="flex-1 min-w-[80px] bg-transparent border-none text-xs outline-none px-1 py-1"
                placeholder="Add a skill…"
              />
            </div>
          </div>

          <div>
            <label class="flex items-center justify-between text-xs font-medium text-slate-700 mb-1">
              <span>Experience (brief notes)</span>
            </label>
            <textarea
              id="g-experience"
              rows="4"
              class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none"
              placeholder="Companies, roles, responsibilities and key achievements."
            ></textarea>
          </div>

          <div>
            <label class="flex items-center justify-between text-xs font-medium text-slate-700 mb-1">
              <span>Education</span>
            </label>
            <input
              id="g-education"
              class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none"
              placeholder="e.g. BSc Computer Science, University, 2024"
            />
          </div>

          <div class="flex flex-wrap items-center gap-3 pt-1">
            <button
              type="submit"
              class="inline-flex items-center gap-1 rounded-full bg-indigo-600 px-4 py-2 text-xs font-semibold text-white shadow-md hover:bg-indigo-700 hover:shadow-lg transition"
            >
              Generate resume
            </button>
            <button
              type="button"
              id="g-clear"
              class="inline-flex items-center gap-1 rounded-full bg-slate-100 px-3 py-2 text-[11px] text-slate-700 hover:bg-slate-200 transition"
            >
              Clear form
            </button>
          </div>
        </form>

        <!-- PREVIEW -->
        <div class="bg-white/80 border border-slate-200 rounded-2xl p-4 shadow-sm flex flex-col gap-3">
          <div class="flex items-center justify-between gap-3">
            <div>
              <h3 class="text-sm font-semibold text-slate-900">
                Resume preview
              </h3>
              <p class="text-[11px] text-slate-500">
                Simple single-page layout preview. Export can be wired to your backend.
              </p>
            </div>
          </div>

          <div class="relative flex-1 rounded-xl border border-slate-200 bg-slate-50/80 p-4 overflow-auto">
            <div id="g-preview-empty" class="h-full flex flex-col items-center justify-center text-center text-[11px] text-slate-400">
              <p>
                Fill the form on the left and click <span class="font-semibold">Generate resume</span>.
              </p>
            </div>
            <div id="g-preview" class="hidden text-[11px] leading-relaxed text-slate-800"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- ANALYZE WORKSPACE -->
    <section id="analyze-panel" class="mb-8 hidden">
      <div class="mb-4 flex items-center justify-between gap-3">
        <div>
          <h2 class="text-sm sm:text-base font-semibold text-slate-900">
            Analyze Resume
          </h2>
          <p class="text-xs sm:text-[13px] text-slate-500">
            Upload or paste your existing resume to get a structured review.
          </p>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-5">
        <!-- FORM -->
        <form id="analyze-form" class="space-y-4 bg-white/80 border border-slate-200 rounded-2xl p-4 shadow-sm">
          <label
            for="a-file"
            class="flex flex-col items-center justify-center gap-1 rounded-xl border border-dashed border-slate-300 bg-slate-50 px-4 py-5 text-center text-xs text-slate-500 cursor-pointer hover:border-indigo-400 hover:bg-indigo-50/50 transition"
          >
            <span class="text-sm">Drag &amp; drop or click to upload</span>
            <span class="text-[11px] text-slate-400">
              PDF · DOCX · TXT · Max 5MB
            </span>
            <span class="mt-1 inline-flex items-center gap-1 rounded-full bg-white px-2.5 py-1 text-[10px] text-slate-500 shadow-sm">
              Optional: you can paste the text below
            </span>
            <input id="a-file" type="file" class="hidden" />
          </label>

          <div>
            <label class="flex items-center justify-between text-xs font-medium text-slate-700 mb-1">
              <span>Or paste resume text</span>
            </label>
            <textarea
              id="a-text"
              rows="6"
              class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none"
              placeholder="Paste your resume text here..."
            ></textarea>
          </div>

          <div>
            <label class="flex items-center justify-between text-xs font-medium text-slate-700 mb-1">
              <span>Target role (optional)</span>
            </label>
            <input
              id="a-role"
              class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none"
              placeholder="e.g. Product Manager"
            />
          </div>

          <div>
            <p class="text-xs font-medium text-slate-700 mb-1">
              What to check
            </p>
            <div class="flex flex-wrap gap-2">
              <label class="inline-flex items-center gap-2 rounded-full bg-slate-50 px-3 py-1 text-[11px] text-slate-700 border border-slate-200">
                <input type="checkbox" class="h-3 w-3 text-indigo-600" checked />
                ATS compatibility
              </label>
              <label class="inline-flex items-center gap-2 rounded-full bg-slate-50 px-3 py-1 text-[11px] text-slate-700 border border-slate-200">
                <input type="checkbox" class="h-3 w-3 text-indigo-600" checked />
                Grammar &amp; style
              </label>
              <label class="inline-flex items-center gap-2 rounded-full bg-slate-50 px-3 py-1 text-[11px] text-slate-700 border border-slate-200">
                <input type="checkbox" class="h-3 w-3 text-indigo-600" checked />
                Achievements &amp; impact
              </label>
            </div>
          </div>

          <div class="flex flex-wrap items-center gap-3 pt-1">
            <button
              type="submit"
              class="inline-flex items-center gap-1 rounded-full bg-indigo-600 px-4 py-2 text-xs font-semibold text-white shadow-md hover:bg-indigo-700 hover:shadow-lg transition"
            >
              Analyze resume
            </button>
            <button
              type="button"
              id="a-clear"
              class="inline-flex items-center gap-1 rounded-full bg-slate-100 px-3 py-2 text-[11px] text-slate-700 hover:bg-slate-200 transition"
            >
              Clear inputs
            </button>
          </div>
        </form>

        <!-- RESULT -->
        <div class="bg-white/80 border border-slate-200 rounded-2xl p-4 shadow-sm flex flex-col gap-3">
          <div class="flex items-center justify-between gap-3">
            <div>
              <h3 class="text-sm font-semibold text-slate-900">
                Analysis result
              </h3>
              <p class="text-[11px] text-slate-500">
                After analysis you will see strengths, issues and next steps here.
              </p>
            </div>
          </div>

          <div class="relative flex-1 rounded-xl border border-slate-200 bg-slate-50/80 p-4 overflow-auto">
            <div id="a-preview-empty" class="h-full flex flex-col items-center justify-center text-center text-[11px] text-slate-400">
              <p>
                Upload or paste your resume, then click <span class="font-semibold">Analyze resume</span>.
              </p>
            </div>
            <div id="a-preview" class="hidden text-[11px] leading-relaxed text-slate-800 space-y-3"></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- SCRIPT -->
  <script>
    // ===== STEP INDICATOR =====
    function setStep(step) {
      var circles = document.querySelectorAll(".step-circle");
      circles.forEach(function (circle, index) {
        var s = index + 1;
        circle.classList.remove(
          "bg-indigo-500",
          "border-indigo-500",
          "text-white",
          "bg-slate-900",
          "border-slate-900",
          "bg-white",
          "border-slate-300",
          "text-slate-500"
        );
        if (s < step) {
          circle.classList.add("bg-slate-900", "border-slate-900", "text-white");
        } else if (s === step) {
          circle.classList.add("bg-indigo-500", "border-indigo-500", "text-white");
        } else {
          circle.classList.add("bg-white", "border-slate-300", "text-slate-500");
        }
      });
    }

    // ===== MODE SWITCHING =====
    var modeButtons = document.querySelectorAll("[data-mode]");
    var modePicker = document.getElementById("mode-picker");
    var generatePanel = document.getElementById("generate-panel");
    var analyzePanel = document.getElementById("analyze-panel");

    modeButtons.forEach(function (btn) {
      btn.addEventListener("click", function () {
        var mode = btn.getAttribute("data-mode");
        if (mode === "generate") {
          generatePanel.classList.remove("hidden");
          analyzePanel.classList.add("hidden");
        } else {
          analyzePanel.classList.remove("hidden");
          generatePanel.classList.add("hidden");
        }
        modePicker.classList.add("opacity-60", "pointer-events-none");
        setStep(2);
        var panel = mode === "generate" ? generatePanel : analyzePanel;
        panel.scrollIntoView({ behavior: "smooth", block: "start" });
      });
    });

    // ===== GENERATE: SKILLS TAGS =====
    var skillsWrapper = document.getElementById("g-skills-wrapper");
    var skillsInput = document.getElementById("g-skills-input");

    skillsWrapper.addEventListener("click", function () {
      skillsInput.focus();
    });

    skillsWrapper.addEventListener("click", function (e) {
      if (e.target.classList.contains("skill-remove")) {
        e.target.closest(".skill-tag").remove();
      }
    });

    skillsInput.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        e.preventDefault();
        var value = skillsInput.value.trim();
        if (!value) return;
        var tag = document.createElement("span");
        tag.className =
          "skill-tag inline-flex items-center gap-1 rounded-full bg-slate-200/80 px-2 py-0.5 text-[11px] text-slate-700";
        tag.innerHTML =
          "<span>" +
          value +
          "</span><button type='button' class='skill-remove ml-1 text-[11px] text-slate-500 hover:text-slate-800'>×</button>";
        skillsWrapper.insertBefore(tag, skillsInput);
        skillsInput.value = "";
      }
      if (e.key === "Backspace" && !skillsInput.value) {
        var tags = skillsWrapper.querySelectorAll(".skill-tag");
        if (tags.length > 0) {
          tags[tags.length - 1].remove();
        }
      }
    });

    // ===== GENERATE: FORM & PREVIEW =====
    var gForm = document.getElementById("generate-form");
    var gPreview = document.getElementById("g-preview");
    var gPreviewEmpty = document.getElementById("g-preview-empty");
    var gClear = document.getElementById("g-clear");

    gForm.addEventListener("submit", function (e) {
      e.preventDefault();

      var name = document.getElementById("g-fullname").value.trim() || "Your Name";
      var contact = document.getElementById("g-contact").value.trim();
      var role = document.getElementById("g-role").value.trim() || "Target Role";
      var level = document.getElementById("g-level").value;
      var summary = document.getElementById("g-summary").value.trim();
      var exp = document.getElementById("g-experience").value.trim();
      var edu = document.getElementById("g-education").value.trim();

      var skillLabels = [];
      skillsWrapper
        .querySelectorAll(".skill-tag span:first-child")
        .forEach(function (el) {
          skillLabels.push(el.textContent.trim());
        });

      var html = "";
      html += "<h1 class='text-sm font-semibold'>" + name + "</h1>";
      html += "<p class='text-[10px] text-slate-500 mb-2'>";
      if (contact) html += contact + " · ";
      html += level + " " + role + "</p>";

      if (summary) {
        html +=
          "<h2 class='mt-2 text-[10px] font-semibold tracking-wide text-slate-600 uppercase'>Summary</h2>";
        html += "<p class='text-[10px]'>" + summary + "</p>";
      }

      if (skillLabels.length) {
        html +=
          "<h2 class='mt-2 text-[10px] font-semibold tracking-wide text-slate-600 uppercase'>Skills</h2>";
        html += "<ul class='list-disc pl-4 text-[10px] space-y-0.5'>";
        skillLabels.forEach(function (s) {
          html += "<li>" + s + "</li>";
        });
        html += "</ul>";
      }

      if (exp) {
        html +=
          "<h2 class='mt-2 text-[10px] font-semibold tracking-wide text-slate-600 uppercase'>Experience</h2>";
        html += "<p class='whitespace-pre-line text-[10px]'>" + exp + "</p>";
      }

      if (edu) {
        html +=
          "<h2 class='mt-2 text-[10px] font-semibold tracking-wide text-slate-600 uppercase'>Education</h2>";
        html += "<p class='text-[10px]'>" + edu + "</p>";
      }

      gPreview.innerHTML = html;
      gPreviewEmpty.classList.add("hidden");
      gPreview.classList.remove("hidden");
      setStep(3);
    });

    gClear.addEventListener("click", function () {
      gForm.reset();
      skillsWrapper.querySelectorAll(".skill-tag").forEach(function (tag) {
        tag.remove();
      });
      gPreview.innerHTML = "";
      gPreview.classList.add("hidden");
      gPreviewEmpty.classList.remove("hidden");
      setStep(2);
    });

    // ===== ANALYZE: FILE FEEDBACK =====
    var aFileInput = document.getElementById("a-file");
    var aTextArea = document.getElementById("a-text");

    aFileInput.addEventListener("change", function (e) {
      var file = e.target.files[0];
      var label = document.querySelector("label[for='a-file']");
      if (!file || !label) return;

      var info = label.querySelector(".file-info");
      if (!info) {
        info = document.createElement("p");
        info.className =
          "file-info mt-2 text-[11px] text-slate-500 border-t border-dashed border-slate-200 pt-2 w-full text-center";
        label.appendChild(info);
      }
      info.textContent =
        "Selected file: " + file.name + " (" + Math.round(file.size / 1024) + " KB)";

      // For TXT files, load content into textarea so analysis works on actual text
      if (file.type === "text/plain") {
        info.textContent += " – loading content…";
        var reader = new FileReader();
        reader.onload = function (ev) {
          aTextArea.value = ev.target.result;
          info.textContent =
            "Selected file: " +
            file.name +
            " (" +
            Math.round(file.size / 1024) +
            " KB, loaded into text area)";
        };
        reader.readAsText(file);
      }
    });

    // ===== ANALYZE: SIMPLE HEURISTIC ANALYSIS =====
    var aForm = document.getElementById("analyze-form");
    var aPreview = document.getElementById("a-preview");
    var aPreviewEmpty = document.getElementById("a-preview-empty");
    var aClear = document.getElementById("a-clear");

    function buildAnalysis(text, role) {
      var cleanText = text.trim();
      var wordCount = cleanText ? cleanText.split(/\s+/).length : 0;
      var sentences = cleanText.match(/[.!?]/g) || [];
      var sentenceCount = sentences.length || 1;
      var avgSentence = Math.round(wordCount / sentenceCount);

      var bulletMatches = cleanText.match(/(^|\n)\s*[-*•]/g) || [];
      var bulletCount = bulletMatches.length;

      var metricMatches =
        cleanText.match(/\d+%|\$\d+|\d+\s+(years?|months?|weeks?|days?)/gi) || [];
      var metricCount = metricMatches.length;

      var strengths = [];
      var issues = [];
      var steps = [];

      if (wordCount > 0 && wordCount <= 500) {
        strengths.push("Overall length is reasonable (" + wordCount + " words).");
      } else if (wordCount > 500) {
        issues.push(
          "Resume may be too long (" +
            wordCount +
            " words). Try to keep it close to one page."
        );
      }

      if (bulletCount >= 3) {
        strengths.push(
          "You use bullet points (" +
            bulletCount +
            "), which makes the resume easier to scan."
        );
      } else if (wordCount > 0) {
        issues.push(
          "Add bullet points for responsibilities and achievements to improve readability."
        );
      }

      if (metricCount > 0) {
        strengths.push(
          "You include numbers and metrics (" + metricCount + " occurrences)."
        );
      } else if (wordCount > 0) {
        issues.push(
          "Add concrete numbers (%, revenue, time saved) to show impact."
        );
      }

      if (avgSentence > 28) {
        issues.push(
          "Sentences are quite long on average (" +
            avgSentence +
            " words). Consider shortening them."
        );
      } else if (avgSentence > 0) {
        strengths.push(
          "Sentence length looks fine (about " +
            avgSentence +
            " words on average)."
        );
      }

      var target = role || "your target role";

      steps.push(
        "Make sure the top of the resume clearly matches \"" +
          target +
          "\" (title, summary, main skills)."
      );
      steps.push(
        "Turn responsibilities into impact statements using metrics where possible (for example: reduced processing time by 20%)."
      );
      steps.push(
        "Keep structure simple: 2–4 sections (Summary, Experience, Skills, Education) and consistent formatting."
      );

      var html = "";

      html +=
        "<div><p class='inline-flex items-center gap-2 rounded-full bg-slate-100 px-2.5 py-1 text-[10px] text-slate-700 mb-2'>" +
        "AI-style review based on " +
        wordCount +
        " words" +
        "</p></div>";

      if (strengths.length) {
        html +=
          "<div><h4 class='text-[10px] font-semibold uppercase tracking-wide text-slate-600 mb-1'>Strengths</h4>";
        html += "<ul class='list-disc pl-4 text-[10px] space-y-0.5'>";
        strengths.forEach(function (s) {
          html += "<li>" + s + "</li>";
        });
        html += "</ul></div>";
      }

      if (issues.length) {
        html +=
          "<div><h4 class='text-[10px] font-semibold uppercase tracking-wide text-slate-600 mb-1'>Issues</h4>";
        html += "<ul class='list-disc pl-4 text-[10px] space-y-0.5'>";
        issues.forEach(function (s) {
          html += "<li>" + s + "</li>";
        });
        html += "</ul></div>";
      }

      html +=
        "<div><h4 class='text-[10px] font-semibold uppercase tracking-wide text-slate-600 mb-1'>Next steps</h4>";
      html += "<ul class='list-disc pl-4 text-[10px] space-y-0.5'>";
      steps.forEach(function (s) {
        html += "<li>" + s + "</li>";
      });
      html += "</ul></div>";

      return html;
    }

    aForm.addEventListener("submit", function (e) {
      e.preventDefault();

      var text = aTextArea.value || "";
      var role = document.getElementById("a-role").value.trim();

      if (!text.trim()) {
        aPreview.innerHTML =
          "<p class='text-[11px] text-slate-500'>Please upload a resume file (TXT recommended) or paste the resume text before running analysis.</p>";
        aPreviewEmpty.classList.add("hidden");
        aPreview.classList.remove("hidden");
        setStep(2);
        return;
      }

      aPreview.innerHTML =
        "<p class='text-[11px] text-slate-500'>Analyzing resume…</p>";
      aPreviewEmpty.classList.add("hidden");
      aPreview.classList.remove("hidden");

      setTimeout(function () {
        var html = buildAnalysis(text, role);
        aPreview.innerHTML = html;
        setStep(3);
      }, 400);
    });

    aClear.addEventListener("click", function () {
      aForm.reset();
      aPreview.innerHTML = "";
      aPreview.classList.add("hidden");
      aPreviewEmpty.classList.remove("hidden");
      setStep(2);
    });
  </script>
</body>
</html>
